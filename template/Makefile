# PTM Pipeline Makefile
# Generated by ptm-pipeline init

# Configuration
CONFIG := ptm_config.yaml
SNAKEFILE := SnakefileV2.smk
CORES := 1

# Pipeline targets
.PHONY: all dry-run clean help install upgrade validate

all: ## Run the full pipeline
	snakemake -s $(SNAKEFILE) --configfile $(CONFIG) -j$(CORES) all

dry-run: ## Show what would be executed (dry-run)
	snakemake -s $(SNAKEFILE) --configfile $(CONFIG) -n all

validate: ## Validate project setup
	ptm-pipeline validate .

clean: ## Remove all output files (keeps config)
	rm -rf PTM_* .snakemake *.zip

# Pipeline management
install: ## Install ptm-pipeline tool
	uv tool install git+https://github.com/wolski/ptm-pipeline

upgrade: ## Upgrade ptm-pipeline to latest version
	uv tool upgrade ptm-pipeline

update: ## Update pipeline files (keeps config)
	ptm-pipeline update .

# Help
help: ## Show this help
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | sort | awk 'BEGIN {FS = ":.*?## "}; {printf "\033[36m%-15s\033[0m %s\n", $$1, $$2}'

.DEFAULT_GOAL := help
