---
title: "PTM Analysis Results"
params:
  folder: "PTM_20251206"
output:
  html_document:
    toc: true
    toc_float: true
    theme: flatly
    self_contained: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
library(dplyr)
```

This page provides an overview of all PTM (Post-Translational Modification) analysis results in the `r params$folder` directory.

```{r discover_files}
# Helper function to find files in a directory
find_files <- function(base_dir, pattern, subdir = NULL) {
  dir_path <- if (!is.null(subdir)) file.path(base_dir, subdir) else base_dir
  if (!dir.exists(dir_path)) return(character(0))
  list.files(dir_path, pattern = pattern, full.names = FALSE)
}

# Analysis directories
dpa_dir <- file.path(params$folder, "PTM_DPA")
dpu_dir <- file.path(params$folder, "PTM_DPU")
cf_dir <- file.path(params$folder, "PTM_CF_DPU")
```

## Combined Results

The combined PTM_results.xlsx contains all analysis results in one file.

```{r combined_results, results='asis'}
combined_xlsx <- file.path(params$folder, "PTM_results.xlsx")
combined_rds <- file.path(params$folder, "PTM_results.rds")

cat("| File | Description |\n")
cat("|------|-------------|\n")
if (file.exists(combined_xlsx)) {
  cat(sprintf("| [PTM_results.xlsx](PTM_results.xlsx) | Combined Excel with sheets: DPA, DPU, CF, abundances |\n"))
}
if (file.exists(combined_rds)) {
  cat(sprintf("| [PTM_results.rds](PTM_results.rds) | R data file for programmatic access |\n"))
}
```

## DPA (Differential PTM Abundance)

Raw phosphosite signal changes - includes protein abundance effects.

```{r dpa_section, results='asis'}
cat("| Analysis | Report |\n")
cat("|----------|--------|\n")

# Main analysis
if (file.exists(file.path(dpa_dir, "Analysis_DPA_DPU.html"))) {
  cat("| Main Analysis | [Analysis_DPA_DPU.html](PTM_DPA/Analysis_DPA_DPU.html) |\n")
}

# N-to-C
if (file.exists(file.path(dpa_dir, "Analysis_n_to_c.html"))) {
  cat("| N-to-C Plots | [Analysis_n_to_c.html](PTM_DPA/Analysis_n_to_c.html) |\n")
}

# Seqlogo
if (file.exists(file.path(dpa_dir, "Analysis_seqlogo.html"))) {
  cat("| Sequence Logos | [Analysis_seqlogo.html](PTM_DPA/Analysis_seqlogo.html) |\n")
}

# PTM-SEA
if (file.exists(file.path(dpa_dir, "PTMSEA/PTMSEA_DPA.html"))) {
  cat("| PTM-SEA | [PTMSEA_DPA.html](PTM_DPA/PTMSEA/PTMSEA_DPA.html) |\n")
}

# KinaseLib GSEA
if (file.exists(file.path(dpa_dir, "KinaseLib/Analysis_KinaseLib_DPA.html"))) {
  cat("| KinaseLib GSEA | [Analysis_KinaseLib_DPA.html](PTM_DPA/KinaseLib/Analysis_KinaseLib_DPA.html) |\n")
}

# KinaseLib MEA
if (file.exists(file.path(dpa_dir, "KinaseLib/Analysis_MEA.html"))) {
  cat("| KinaseLib MEA | [Analysis_MEA.html](PTM_DPA/KinaseLib/Analysis_MEA.html) |\n")
}

# Data files
dpa_xlsx <- find_files(dpa_dir, "\\.xlsx$")
for (f in dpa_xlsx) {
  cat(sprintf("| Data | [%s](PTM_DPA/%s) |\n", f, f))
}

# PDFs
dpa_pdfs <- c(find_files(dpa_dir, "\\.pdf$"),
              find_files(dpa_dir, "\\.pdf$", "PTMSEA"),
              find_files(dpa_dir, "\\.pdf$", "KinaseLib"))
if (length(dpa_pdfs) > 0) {
  cat("| PDF Plots | ", paste(sapply(find_files(dpa_dir, "\\.pdf$"), function(f) sprintf("[%s](PTM_DPA/%s)", f, f)), collapse = ", "), " |\n")
}
```

## DPU (Differential PTM Usage)

Protein-normalized stoichiometry changes - true phosphorylation changes independent of protein abundance.

```{r dpu_section, results='asis'}
cat("| Analysis | Report |\n")
cat("|----------|--------|\n")

# DPU Overview
if (file.exists(file.path(dpu_dir, "Result_DPU.html"))) {
  cat("| DPU Integration Overview | [Result_DPU.html](PTM_DPU/Result_DPU.html) |\n")
}

# N-to-C
if (file.exists(file.path(dpu_dir, "Analysis_n_to_c.html"))) {
  cat("| N-to-C Plots | [Analysis_n_to_c.html](PTM_DPU/Analysis_n_to_c.html) |\n")
}

# Seqlogo
if (file.exists(file.path(dpu_dir, "Analysis_seqlogo.html"))) {
  cat("| Sequence Logos | [Analysis_seqlogo.html](PTM_DPU/Analysis_seqlogo.html) |\n")
}

# PTM-SEA
if (file.exists(file.path(dpu_dir, "PTMSEA/PTMSEA_DPU.html"))) {
  cat("| PTM-SEA | [PTMSEA_DPU.html](PTM_DPU/PTMSEA/PTMSEA_DPU.html) |\n")
}

# KinaseLib GSEA
if (file.exists(file.path(dpu_dir, "KinaseLib/Analysis_KinaseLib_DPU.html"))) {
  cat("| KinaseLib GSEA | [Analysis_KinaseLib_DPU.html](PTM_DPU/KinaseLib/Analysis_KinaseLib_DPU.html) |\n")
}

# KinaseLib MEA
if (file.exists(file.path(dpu_dir, "KinaseLib/Analysis_MEA.html"))) {
  cat("| KinaseLib MEA | [Analysis_MEA.html](PTM_DPU/KinaseLib/Analysis_MEA.html) |\n")
}

# Data files
dpu_xlsx <- find_files(dpu_dir, "\\.xlsx$")
for (f in dpu_xlsx) {
  cat(sprintf("| Data | [%s](PTM_DPU/%s) |\n", f, f))
}
```

## CorrectFirst (CF)

Alternative protein-correction approach - subtracts protein abundance before statistical modeling.

```{r cf_section, results='asis'}
cat("| Analysis | Report |\n")
cat("|----------|--------|\n")

# Main analysis
if (file.exists(file.path(cf_dir, "Analysis_CorrectFirst_DEA.html"))) {
  cat("| Main Analysis | [Analysis_CorrectFirst_DEA.html](PTM_CF_DPU/Analysis_CorrectFirst_DEA.html) |\n")
}

# N-to-C
if (file.exists(file.path(cf_dir, "Analysis_n_to_c.html"))) {
  cat("| N-to-C Plots | [Analysis_n_to_c.html](PTM_CF_DPU/Analysis_n_to_c.html) |\n")
}

# Seqlogo
if (file.exists(file.path(cf_dir, "Analysis_seqlogo.html"))) {
  cat("| Sequence Logos | [Analysis_seqlogo.html](PTM_CF_DPU/Analysis_seqlogo.html) |\n")
}

# PTM-SEA
if (file.exists(file.path(cf_dir, "PTMSEA/PTMSEA_CF.html"))) {
  cat("| PTM-SEA | [PTMSEA_CF.html](PTM_CF_DPU/PTMSEA/PTMSEA_CF.html) |\n")
}

# KinaseLib GSEA
if (file.exists(file.path(cf_dir, "KinaseLib/Analysis_KinaseLib_CF.html"))) {
  cat("| KinaseLib GSEA | [Analysis_KinaseLib_CF.html](PTM_CF_DPU/KinaseLib/Analysis_KinaseLib_CF.html) |\n")
}

# KinaseLib MEA
if (file.exists(file.path(cf_dir, "KinaseLib/Analysis_MEA.html"))) {
  cat("| KinaseLib MEA | [Analysis_MEA.html](PTM_CF_DPU/KinaseLib/Analysis_MEA.html) |\n")
}

# Data files
cf_xlsx <- find_files(cf_dir, "\\.xlsx$")
for (f in cf_xlsx) {
  cat(sprintf("| Data | [%s](PTM_CF_DPU/%s) |\n", f, f))
}
```

---

*Generated on `r Sys.Date()`*
